# Milestone 2: 팬 핵심 기능 구현 - Work Package 분해

## 개요

**Milestone 목표**: 팬이 질문하고, 답변을 보고, 커뮤니티를 이용할 수 있는 환경 구축

**예상 기간**: 3주 (15일)

**완료 기준**: 팬이 질문 작성→좋아요→정렬 플로우 완성, 셀럽 구독 후 답변 필터링 가능, 커뮤니티 글 작성/댓글 정상 작동

---

## Work Package 구조

```
WP-2.1: 질문 작성 및 기본 목록 화면
WP-2.2: 질문 좋아요 기능 및 정렬
WP-2.3: 셀럽 프로필 및 구독 시스템
WP-2.4: 답변 피드 (Q&A 연결)
WP-2.5: 팬 커뮤니티 (게시글/댓글)
```

---

## WP-2.1: 질문 작성 및 기본 목록 화면

### 목표

팬이 질문을 작성하고, 전체 질문 목록을 볼 수 있는 기본 플로우 구현

### 사용자 가치

팬이 셀럽에게 질문을 등록하고, 다른 팬들의 질문을 탐색할 수 있음

### 작업 내용

1. **질문 작성 화면 구현**
   - `lib/features/fan/screens/create_question_screen.dart` 생성
   - 텍스트 입력 필드 (다중 라인, 최대 글자수 제한)
   - 제출 버튼
   - 기본 유효성 검증 (빈 질문 방지)

2. **클라이언트 사이드 욕설 필터링 (1차)**
   - `lib/shared/utils/profanity_filter.dart` 생성
   - 기본 욕설 사전 기반 필터링
   - 제출 시 욕설 포함 여부 검사
   - 욕설 포함 시 경고 메시지 표시 (제출 차단)

3. **질문 서비스 및 모델 구현**
   - `lib/features/fan/models/question_model.dart` 생성
   - `lib/features/fan/services/question_service.dart` 생성
   - `createQuestion()`: 질문 생성 API 호출
   - `getQuestions()`: 전체 질문 목록 조회 (최신순)

4. **질문 목록 화면 구현**
   - `lib/features/fan/screens/questions_list_screen.dart` 생성
   - 질문 카드 위젯 (`QuestionCard`)
   - 질문 작성자 정보 표시
   - 작성 시간 표시
   - 무한 스크롤 또는 페이지네이션 (초기 구현: 페이지네이션)

5. **질문 상세 화면 (기본)**
   - `lib/features/fan/screens/question_detail_screen.dart` 생성
   - 질문 내용 상세 표시
   - 답변 영역 (셀럽 답변 표시, 미답변 시 안내 메시지)

6. **라우팅 통합**
   - `/fan/questions` 라우트 실제 화면 연결
   - 질문 작성 화면으로 이동 버튼
   - 질문 목록 → 상세 화면 네비게이션

### 완료 조건

- [ ] 팬이 질문을 작성하고 저장할 수 있음
- [ ] 욕설 포함 질문은 제출이 차단되고 경고 메시지 표시
- [ ] 질문 목록이 화면에 표시됨 (최신순)
- [ ] 질문 상세 화면에서 질문 내용 확인 가능
- [ ] 질문 작성 후 목록 화면으로 이동

### 산출물

- 질문 작성 화면
- 질문 목록 화면
- 질문 상세 화면
- 욕설 필터링 유틸리티

### 예상 소요 시간

3일

### 의존성

- WP-1.1 (데이터베이스 스키마)
- WP-1.2 (Supabase Auth)
- WP-1.3 (사용자 프로필)
- WP-1.4 (라우팅)
- WP-1.5 (RBAC)

---

## WP-2.2: 질문 좋아요 기능 및 정렬

### 목표

팬이 질문에 좋아요를 누르고, 좋아요순으로 질문을 정렬하여 볼 수 있는 기능 구현

### 사용자 가치

인기 질문을 쉽게 발견하고, 자신의 의견(좋아요)을 표현할 수 있음

### 작업 내용

1. **좋아요 기능 구현**
   - `question_likes` 테이블 활용 (이미 스키마에 존재)
   - `QuestionService.toggleLike()`: 좋아요 토글 기능
   - 좋아요 상태 관리 (좋아요 누름/취소)
   - 좋아요 수 실시간 업데이트

2. **질문 카드 UI 개선**
   - 좋아요 버튼 추가 (하트 아이콘)
   - 좋아요 수 표시
   - 좋아요 상태에 따른 아이콘 색상 변경 (빨간색/회색)

3. **정렬 기능 구현**
   - 정렬 옵션: 최신순, 좋아요순
   - 정렬 드롭다운/탭 UI
   - `QuestionService.getQuestions()`: 정렬 파라미터 추가
   - 좋아요순 정렬 쿼리 최적화 (인덱스 활용)

4. **무한 스크롤 개선**
   - Supabase의 `range()` 사용하여 페이지네이션 구현
   - 스크롤 끝 감지
   - 로딩 인디케이터
   - 정렬 변경 시 목록 리셋

5. **실시간 좋아요 업데이트 (선택)**
   - Supabase Realtime 구독
   - 다른 사용자가 좋아요를 누르면 실시간 반영
   - 네트워크 오류 시 폴백 처리

### 완료 조건

- [ ] 팬이 질문에 좋아요를 누르고 취소할 수 있음
- [ ] 좋아요 수가 실시간으로 업데이트됨
- [ ] 좋아요순 정렬이 정상 작동함
- [ ] 무한 스크롤로 많은 질문을 탐색할 수 있음
- [ ] 중복 좋아요 방지 (한 질문에 한 번만 좋아요 가능)

### 산출물

- 좋아요 기능이 포함된 질문 카드
- 정렬 기능이 포함된 질문 목록 화면
- 실시간 좋아요 업데이트 (선택)

### 예상 소요 시간

2일

### 의존성

- WP-2.1 (질문 작성 및 목록)

---

## WP-2.3: 셀럽 프로필 및 구독 시스템

### 목표

팬이 셀럽을 탐색하고, 구독하여 해당 셀럽의 콘텐츠만 볼 수 있도록 함

### 사용자 가치

관심 있는 셀럽의 콘텐츠만 필터링하여 볼 수 있음

### 작업 내용

1. **셀럽 리스트 화면 구현**
   - `lib/features/fan/screens/celebrities_list_screen.dart` 생성
   - 셀럽 카드 위젯 (`CelebrityCard`)
   - 셀럽 프로필 이미지, 이름, 간단 소개 표시
   - 구독자 수 표시
   - 검색 기능 (셀럽 이름으로 검색)

2. **셀럽 프로필 화면 구현**
   - `lib/features/fan/screens/celebrity_profile_screen.dart` 생성
   - 셀럽 프로필 정보 표시 (이미지, 이름, 소개)
   - 구독/구독취소 버튼
   - 구독자 수 표시
   - 해당 셀럽의 최근 답변 목록 (미리보기)

3. **구독 기능 구현**
   - `lib/features/fan/services/subscription_service.dart` 생성
   - `subscribe()`: 구독 생성
   - `unsubscribe()`: 구독 취소
   - 구독 상태 확인 (`isSubscribed()`)
   - 구독 상태에 따른 버튼 텍스트 변경

4. **내 구독 목록 관리**
   - 홈 화면에 "내 구독" 섹션 추가
   - 구독한 셀럽 목록 표시
   - 구독 관리 화면 (`my_subscriptions_screen.dart`)
   - 구독 취소 기능

5. **셀럽 서비스 구현**
   - `lib/features/fan/services/celebrity_service.dart` 생성
   - `getCelebrities()`: 전체 셀럽 목록 조회
   - `getCelebrityProfile()`: 셀럽 프로필 상세 조회
   - `searchCelebrities()`: 셀럽 검색

6. **라우팅 통합**
   - 셀럽 리스트 화면 라우트 추가 (홈 화면에서 접근)
   - 셀럽 프로필 화면 라우트 추가
   - 내 구독 목록 화면 라우트 추가

### 완료 조건

- [ ] 팬이 전체 셀럽 목록을 볼 수 있음
- [ ] 셀럽 프로필에서 구독/구독취소 가능
- [ ] 구독한 셀럽 목록을 확인할 수 있음
- [ ] 구독 상태가 실시간으로 반영됨
- [ ] 셀럽 검색 기능 작동

### 산출물

- 셀럽 리스트 화면
- 셀럽 프로필 화면
- 구독 관리 화면
- 구독 서비스

### 예상 소요 시간

3일

### 의존성

- WP-1.1 (데이터베이스 스키마 - subscriptions 테이블)
- WP-2.1 (질문 기본 기능)

---

## WP-2.4: 답변 피드 (Q&A 연결)

### 목표

팬이 구독한 셀럽의 답변을 Q&A 형태로 연결하여 볼 수 있는 피드 구현

### 사용자 가치

셀럽의 답변과 원본 질문을 함께 확인하여 맥락을 이해할 수 있음

### 작업 내용

1. **답변 피드 화면 구현**
   - `lib/features/fan/screens/answers_feed_screen.dart` 생성
   - Q&A 카드 위젯 (`QACard`)
   - 질문 내용 표시
   - 셀럽 답변 내용 표시
   - 셀럽 정보 (프로필 이미지, 이름)
   - 답변 작성 시간 표시

2. **답변 서비스 구현**
   - `lib/features/fan/services/answer_service.dart` 생성
   - `getAnswersFeed()`: 구독한 셀럽의 답변 목록 조회
   - `getAnswerWithQuestion()`: 답변과 원본 질문 조인 조회
   - 날짜별 필터링 옵션

3. **필터링 기능**
   - 구독한 셀럽만 필터링
   - 전체 답변 보기 옵션
   - 날짜별 필터 (오늘, 이번 주, 이번 달)

4. **실시간 업데이트**
   - Supabase Realtime 구독
   - 새로운 답변 게시 시 자동 업데이트
   - 목록 새로고침 기능

5. **홈 화면 통합**
   - 팬 홈 화면에 답변 피드 섹션 추가
   - 최근 답변 3-5개 미리보기
   - "더보기" 버튼으로 전체 피드 이동

6. **Q&A 상세 화면**
   - 질문 상세 화면 개선
   - 답변이 있는 경우 답변 영역 강조 표시
   - 답변 좋아요 기능 (선택, WP-2.2와 유사)

### 완료 조건

- [ ] 구독한 셀럽의 답변 목록이 표시됨
- [ ] 질문과 답변이 Q&A 형태로 연결되어 표시됨
- [ ] 새로운 답변 게시 시 피드에 자동 반영 (Realtime)
- [ ] 날짜별 필터링 기능 작동
- [ ] 홈 화면에서 최근 답변 미리보기 가능

### 산출물

- 답변 피드 화면
- Q&A 카드 위젯
- 답변 서비스
- 홈 화면 답변 피드 통합

### 예상 소요 시간

2.5일

### 의존성

- WP-2.3 (셀럽 구독 시스템)
- WP-2.1 (질문 기본 기능)

---

## WP-2.5: 팬 커뮤니티 (게시글/댓글)

### 목표

팬들이 자유롭게 소통할 수 있는 커뮤니티 기능 구현

### 사용자 가치

팬들 간의 자유로운 소통과 정보 공유가 가능함

### 작업 내용

1. **커뮤니티 게시글 모델 및 서비스**
   - `lib/features/fan/models/community_post_model.dart` 생성
   - `lib/features/fan/services/community_service.dart` 생성
   - `createPost()`: 게시글 작성
   - `getPosts()`: 게시글 목록 조회
   - `updatePost()`: 게시글 수정
   - `deletePost()`: 게시글 삭제
   - `getPostDetail()`: 게시글 상세 조회

2. **커뮤니티 목록 화면**
   - `lib/features/fan/screens/community_list_screen.dart` 생성
   - 게시글 카드 위젯 (`CommunityPostCard`)
   - 작성자 정보, 제목, 내용 미리보기
   - 작성 시간, 댓글 수 표시
   - 무한 스크롤

3. **게시글 작성/수정 화면**
   - `lib/features/fan/screens/create_community_post_screen.dart` 생성
   - 제목 입력 필드
   - 내용 입력 필드 (다중 라인)
   - 작성/수정 버튼
   - 수정 시 기존 내용 로드

4. **게시글 상세 화면**
   - `lib/features/fan/screens/community_post_detail_screen.dart` 생성
   - 게시글 내용 전체 표시
   - 작성자 정보 표시
   - 수정/삭제 버튼 (작성자만 표시)
   - 댓글 목록 표시
   - 댓글 작성 영역

5. **댓글 기능 구현**
   - `lib/features/fan/models/community_comment_model.dart` 생성
   - `CommunityService.createComment()`: 댓글 작성
   - `CommunityService.getComments()`: 댓글 목록 조회
   - `CommunityService.deleteComment()`: 댓글 삭제
   - 댓글 카드 위젯 (`CommentCard`)
   - 댓글 작성자 정보, 내용, 작성 시간 표시

6. **검색 및 필터링**
   - 검색 바 UI
   - 제목/내용 기반 검색
   - 최신순/인기순 정렬 (댓글 수 기준)
   - 작성자별 필터링 (선택)

7. **라우팅 통합**
   - `/fan/community` 라우트 실제 화면 연결
   - 게시글 작성 화면 라우트
   - 게시글 상세 화면 라우트

8. **권한 관리**
   - 게시글 수정/삭제는 작성자만 가능 (RBAC 활용)
   - 댓글 삭제는 작성자만 가능
   - 권한 체크 UI 반영

### 완료 조건

- [ ] 팬이 커뮤니티 게시글을 작성할 수 있음
- [ ] 게시글 목록이 화면에 표시됨
- [ ] 게시글 상세 화면에서 내용과 댓글을 볼 수 있음
- [ ] 댓글을 작성하고 삭제할 수 있음
- [ ] 게시글 검색 및 필터링 기능 작동
- [ ] 작성자만 자신의 게시글/댓글을 수정/삭제할 수 있음

### 산출물

- 커뮤니티 목록 화면
- 게시글 작성/수정 화면
- 게시글 상세 화면
- 댓글 기능
- 커뮤니티 서비스

### 예상 소요 시간

3.5일

### 의존성

- WP-1.1 (데이터베이스 스키마 - communities, community_comments 테이블)
- WP-1.5 (RBAC - 권한 검증)

---

## Work Package 의존성 다이어그램

```
WP-2.1 (질문 작성/목록)
    ↓
WP-2.2 (좋아요/정렬) ← WP-2.1
    ↓
WP-2.3 (셀럽/구독) ← WP-2.1
    ↓
WP-2.4 (답변 피드) ← WP-2.3, WP-2.1
    ↓
WP-2.5 (커뮤니티) ← 독립적 (병렬 개발 가능)
```

---

## 전체 타임라인 (15일 기준)

| 일차 | Work Package | 누적 진행률 |
|------|--------------|------------|
| 1-3일 | WP-2.1: 질문 작성 및 목록 | 33% |
| 4-5일 | WP-2.2: 좋아요 및 정렬 | 53% |
| 6-8일 | WP-2.3: 셀럽 구독 시스템 | 73% |
| 9-11일 | WP-2.4: 답변 피드 | 87% |
| 12-15일 | WP-2.5: 팬 커뮤니티 | 100% |

---

## Vertical Slicing 원칙 적용

각 Work Package는 **독립적으로 테스트 가능한 사용자 가치**를 전달합니다:

1. **WP-2.1**: 질문 작성 → 목록 보기 (핵심 플로우 완성)
2. **WP-2.2**: 좋아요 → 정렬된 목록 (인기 질문 발견)
3. **WP-2.3**: 셀럽 탐색 → 구독 (개인화 시작)
4. **WP-2.4**: 구독한 셀럽 답변 보기 (핵심 가치 전달)
5. **WP-2.5**: 커뮤니티 소통 (추가 가치)

각 WP 완료 후에는 **"동작하는 소프트웨어"**가 생성되며, 사용자가 실제로 테스트할 수 있는 상태입니다.

---

## 완료 조건 체크리스트 (Milestone 2 전체)

- [ ] 팬이 질문 작성하고 다른 팬 질문에 좋아요 가능
- [ ] 욕설 포함 질문은 제출 차단
- [ ] 좋아요순 정렬이 실시간으로 작동
- [ ] 셀럽 구독 후 해당 셀럽 답변만 필터링 확인 가능
- [ ] 커뮤니티 글 작성/댓글 정상 작동

