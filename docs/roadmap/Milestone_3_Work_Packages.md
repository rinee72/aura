# Milestone 3: 셀럽 핵심 기능 구현 - Work Package 분해

## 개요

**Milestone 목표**: 셀럽이 정제된 질문을 확인하고 답변할 수 있는 시스템 구축

**예상 기간**: 2.5주 (12.5일)

**완료 기준**: 셀럽이 좋아요 Top 10 질문 확인 가능, 질문 선택 후 답변 작성 및 게시 성공, 답변이 팬 피드에 실시간 반영, 셀럽 피드 작성 및 이미지 업로드 정상 작동, 답변 안 한 질문은 계속 노출, 답변한 질문은 '답변완료' 상태 변경

---

## Work Package 구조

```
WP-3.1: 질문 큐레이션 대시보드
WP-3.2: 답변 작성 시스템
WP-3.3: 답변 관리
WP-3.4: 셀럽 프로필 관리
WP-3.5: 셀럽 피드 작성
```

---

## WP-3.1: 질문 큐레이션 대시보드

### 목표

셀럽이 좋아요 기반으로 정제된 Top 질문을 확인할 수 있는 대시보드 구현

### 사용자 가치

셀럽이 수백 개의 질문 중에서 가장 인기 있는 질문만 선별하여 확인할 수 있어 피로도가 크게 감소함

### 작업 내용

1. **질문 큐레이션 서비스 구현**
   - `lib/features/celebrity/services/question_curation_service.dart` 생성
   - `getTopQuestions()`: 좋아요순 Top N 질문 조회 (기본값: 10개)
   - `getQuestionsByDateRange()`: 날짜별 필터링 (오늘, 이번 주, 이번 달)
   - `getUnansweredQuestions()`: 미답변 질문만 필터링
   - `getAnsweredQuestions()`: 답변완료 질문 필터링
   - 좋아요 수 기준 정렬 (내림차순)
   - `is_hidden = false` 조건 적용 (매니저가 숨긴 질문 제외)

2. **질문 큐레이션 모델**
   - `lib/features/celebrity/models/curated_question_model.dart` 생성
   - 질문 정보 + 좋아요 수 + 답변 상태 포함
   - 작성자 정보 포함 (선택)

3. **질문 큐레이션 대시보드 화면**
   - `lib/features/celebrity/screens/question_curation_dashboard_screen.dart` 생성
   - Top 질문 리스트 표시 (카드 형태)
   - 질문 카드 위젯 (`CuratedQuestionCard`)
     - 질문 내용 표시
     - 좋아요 수 표시
     - 작성 시간 표시
     - 답변 상태 배지 (미답변/답변완료)
     - 질문 선택 버튼 (답변 작성 화면으로 이동)

4. **필터링 및 정렬 UI**
   - 날짜별 필터 탭 (오늘, 이번 주, 이번 달, 전체)
   - 상태별 필터 (전체, 미답변, 답변완료)
   - 새로고침 버튼
   - 로딩 인디케이터

5. **질문 상세 미리보기**
   - 질문 카드 탭 시 상세 정보 표시 (선택)
   - 또는 바로 답변 작성 화면으로 이동

6. **라우팅 통합**
   - 셀럽 대시보드에 질문 큐레이션 섹션 추가
   - `/celebrity/dashboard` 라우트에 통합
   - 질문 선택 시 `/celebrity/questions/:questionId/answer`로 이동

### 완료 조건

- [ ] 셀럽이 좋아요 Top 10 질문을 확인할 수 있음
- [ ] 날짜별 필터링이 정상 작동함
- [ ] 미답변/답변완료 상태별 필터링이 작동함
- [ ] 질문 선택 시 답변 작성 화면으로 이동 가능
- [ ] 매니저가 숨긴 질문은 표시되지 않음
- [ ] 좋아요 수가 실시간으로 반영됨 (Realtime 구독, 선택)

### 산출물

- 질문 큐레이션 대시보드 화면
- 질문 큐레이션 서비스
- CuratedQuestionCard 위젯
- 질문 큐레이션 모델

### 예상 소요 시간

3일

### 의존성

- WP-2.1 (질문 작성 및 목록)
- WP-2.2 (좋아요 기능)
- WP-1.1 (데이터베이스 스키마 - questions, question_likes 테이블)
- WP-1.5 (RBAC - 셀럽 권한 검증)

---

## WP-3.2: 답변 작성 시스템

### 목표

셀럽이 질문을 선택하여 답변을 작성하고 게시할 수 있는 시스템 구현

### 사용자 가치

셀럽이 질문에 대한 답변을 작성하여 팬들에게 전달할 수 있음. 임시저장 기능으로 시간에 구애받지 않고 답변을 작성할 수 있음

### 작업 내용

1. **답변 서비스 구현 (셀럽용)**
   - `lib/features/celebrity/services/answer_service.dart` 생성
   - `createAnswer()`: 답변 생성 (임시저장 또는 게시)
   - `updateAnswer()`: 답변 수정
   - `publishAnswer()`: 임시저장 → 게시 전환
   - `getAnswerByQuestionId()`: 특정 질문의 답변 조회
   - 권한 검증 (셀럽만 답변 가능, 자신의 질문에만 답변 가능)

2. **답변 작성 화면**
   - `lib/features/celebrity/screens/create_answer_screen.dart` 생성
   - 질문 내용 표시 (읽기 전용)
   - 답변 입력 필드 (다중 라인, 최대 글자수 제한)
   - 글자수 표시
   - 답변 미리보기 기능 (선택)
   - 임시저장 버튼
   - 게시 버튼
   - 취소 버튼

3. **답변 모델 (셀럽용)**
   - `lib/features/celebrity/models/answer_model.dart` 생성
   - `is_draft` 필드 포함
   - 질문 정보 포함 (선택)

4. **유효성 검증**
   - 빈 답변 방지
   - 최소 글자수 제한
   - 최대 글자수 제한
   - 권한 검증 (PermissionChecker 사용)

5. **상태 관리**
   - 답변 게시 시 `questions.status`를 'answered'로 업데이트 (트리거 또는 서비스 레벨)
   - 답변 삭제 시 `questions.status`를 'pending'으로 복원
   - 임시저장 답변은 상태 변경 없음

6. **라우팅 통합**
   - `/celebrity/questions/:questionId/answer` 라우트 추가
   - 질문 큐레이션 대시보드에서 질문 선택 시 이동
   - 기존 답변이 있으면 수정 모드로 진입

7. **실시간 업데이트**
   - 답변 게시 시 Supabase Realtime으로 팬 피드에 자동 반영
   - 구독한 팬들에게 알림 (선택, 향후 구현)

### 완료 조건

- [ ] 셀럽이 질문을 선택하여 답변을 작성할 수 있음
- [ ] 답변을 임시저장할 수 있음
- [ ] 답변을 게시할 수 있음
- [ ] 답변 게시 시 질문 상태가 'answered'로 변경됨
- [ ] 답변이 팬 피드에 실시간 반영됨
- [ ] 기존 답변이 있으면 수정 모드로 진입 가능
- [ ] 권한 검증이 정상 작동함 (셀럽만 답변 가능)

### 산출물

- 답변 작성 화면
- 답변 서비스 (셀럽용)
- 답변 모델 (셀럽용)
- 답변 미리보기 기능 (선택)

### 예상 소요 시간

3일

### 의존성

- WP-3.1 (질문 큐레이션 대시보드)
- WP-2.1 (질문 기본 기능)
- WP-1.1 (데이터베이스 스키마 - answers 테이블)
- WP-1.5 (RBAC - 셀럽 권한 검증)

---

## WP-3.3: 답변 관리

### 목표

셀럽이 자신이 작성한 답변을 관리할 수 있는 시스템 구현

### 사용자 가치

셀럽이 자신의 답변 목록을 확인하고, 수정/삭제할 수 있어 콘텐츠 관리가 용이함

### 작업 내용

1. **답변 관리 서비스 확장**
   - `AnswerService.getMyAnswers()`: 내 답변 목록 조회
   - `AnswerService.deleteAnswer()`: 답변 삭제
   - 필터링 옵션 (전체, 게시됨, 임시저장)
   - 정렬 옵션 (최신순, 오래된순)

2. **내 답변 목록 화면**
   - `lib/features/celebrity/screens/my_answers_screen.dart` 생성
   - 답변 카드 위젯 (`AnswerCard`)
     - 질문 내용 미리보기
     - 답변 내용 미리보기
     - 작성 시간 표시
     - 상태 배지 (게시됨/임시저장)
     - 수정/삭제 버튼

3. **답변 상세 화면**
   - `lib/features/celebrity/screens/answer_detail_screen.dart` 생성
   - 질문 전체 내용 표시
   - 답변 전체 내용 표시
   - 수정/삭제 버튼
   - 게시/임시저장 전환 버튼

4. **답변 통계 (선택)**
   - 조회수 표시 (향후 구현)
   - 좋아요 수 표시 (향후 구현)
   - 통계 대시보드 (향후 구현)

5. **필터링 및 검색**
   - 상태별 필터 (전체, 게시됨, 임시저장)
   - 날짜별 필터 (오늘, 이번 주, 이번 달)
   - 검색 기능 (질문 내용 또는 답변 내용 검색)

6. **라우팅 통합**
   - `/celebrity/my-answers` 라우트 추가
   - 셀럽 대시보드에 "내 답변" 섹션 추가
   - 답변 카드 클릭 시 상세 화면으로 이동

### 완료 조건

- [ ] 셀럽이 자신의 답변 목록을 확인할 수 있음
- [ ] 답변을 수정할 수 있음
- [ ] 답변을 삭제할 수 있음
- [ ] 임시저장 답변을 게시로 전환할 수 있음
- [ ] 게시된 답변을 임시저장으로 전환할 수 있음
- [ ] 필터링 및 검색 기능이 작동함
- [ ] 답변 삭제 시 질문 상태가 'pending'으로 복원됨

### 산출물

- 내 답변 목록 화면
- 답변 상세 화면
- 답변 카드 위젯
- 답변 관리 서비스 확장

### 예상 소요 시간

2.5일

### 의존성

- WP-3.2 (답변 작성 시스템)
- WP-1.1 (데이터베이스 스키마 - answers 테이블)
- WP-1.5 (RBAC - 셀럽 권한 검증)

---

## WP-3.4: 셀럽 프로필 관리

### 목표

셀럽이 자신의 프로필 정보를 관리할 수 있는 시스템 구현

### 사용자 가치

셀럽이 프로필 이미지, 소개, 계정 설정을 관리하여 자신의 브랜드를 표현할 수 있음

### 작업 내용

1. **셀럽 프로필 서비스 구현**
   - `lib/features/celebrity/services/celebrity_profile_service.dart` 생성
   - `updateProfile()`: 프로필 정보 수정
   - `updateProfileImage()`: 프로필 이미지 업로드 (Supabase Storage)
   - `getMyProfile()`: 내 프로필 조회
   - `getSubscriberCount()`: 구독자 수 조회

2. **프로필 관리 화면**
   - `lib/features/celebrity/screens/profile_management_screen.dart` 생성
   - 프로필 이미지 업로드/수정
   - 이름/닉네임 수정
   - 소개글 수정 (다중 라인)
   - 구독자 수 표시 (읽기 전용)
   - 저장 버튼

3. **프로필 이미지 업로드**
   - 이미지 선택 (갤러리 또는 카메라)
   - 이미지 미리보기
   - 이미지 크기 제한 및 압축
   - Supabase Storage에 업로드
   - 업로드 진행률 표시

4. **계정 설정 화면**
   - `lib/features/celebrity/screens/account_settings_screen.dart` 생성
   - 이메일 변경 (선택, 향후 구현)
   - 비밀번호 변경 (선택, 향후 구현)
   - 알림 설정 (선택, 향후 구현)
   - 계정 삭제 (선택, 향후 구현)

5. **구독자 통계 (선택)**
   - 구독자 수 실시간 표시
   - 구독자 증가 추이 그래프 (향후 구현)
   - 구독자 목록 (선택, 향후 구현)

6. **라우팅 통합**
   - `/celebrity/profile` 라우트 추가
   - `/celebrity/settings` 라우트 추가
   - 셀럽 대시보드에 프로필 관리 링크 추가

### 완료 조건

- [ ] 셀럽이 프로필 이미지를 업로드/수정할 수 있음
- [ ] 셀럽이 이름/소개글을 수정할 수 있음
- [ ] 구독자 수가 실시간으로 표시됨
- [ ] 프로필 변경 사항이 팬 화면에 반영됨
- [ ] 이미지 업로드가 정상 작동함 (Supabase Storage)

### 산출물

- 프로필 관리 화면
- 계정 설정 화면
- 셀럽 프로필 서비스
- 프로필 이미지 업로드 기능

### 예상 소요 시간

2일

### 의존성

- WP-1.1 (데이터베이스 스키마 - users 테이블)
- WP-1.3 (사용자 프로필)
- WP-1.5 (RBAC - 셀럽 권한 검증)
- Supabase Storage 설정

---

## WP-3.5: 셀럽 피드 작성

### 목표

셀럽이 일반 피드를 작성하고 이미지를 업로드할 수 있는 시스템 구현

### 사용자 가치

셀럽이 질문-답변 외에도 자유로운 콘텐츠를 공유하여 팬들과 소통할 수 있음

### 작업 내용

1. **셀럽 피드 모델 및 서비스**
   - `lib/features/celebrity/models/celebrity_feed_model.dart` 생성
   - `lib/features/celebrity/services/feed_service.dart` 생성
   - `createFeed()`: 피드 작성
   - `updateFeed()`: 피드 수정
   - `deleteFeed()`: 피드 삭제
   - `getMyFeeds()`: 내 피드 목록 조회
   - `uploadFeedImage()`: 피드 이미지 업로드 (Supabase Storage)

2. **피드 작성 화면**
   - `lib/features/celebrity/screens/create_feed_screen.dart` 생성
   - 텍스트 입력 필드 (다중 라인)
   - 이미지 업로드 기능
     - 이미지 선택 (갤러리 또는 카메라)
     - 이미지 미리보기
     - 이미지 삭제
     - 여러 이미지 업로드 지원 (최대 5개, 선택)
   - 글자수 표시
   - 게시 버튼
   - 취소 버튼

3. **피드 목록 화면**
   - `lib/features/celebrity/screens/my_feeds_screen.dart` 생성
   - 피드 카드 위젯 (`FeedCard`)
     - 피드 내용 표시
     - 이미지 미리보기
     - 작성 시간 표시
     - 수정/삭제 버튼

4. **이미지 업로드 처리**
   - 이미지 크기 제한 (예: 5MB)
   - 이미지 압축 (선택)
   - 업로드 진행률 표시
   - 업로드 실패 시 재시도 기능
   - Supabase Storage에 저장
   - 이미지 URL을 피드 데이터에 저장

5. **피드 수정/삭제**
   - 피드 수정 화면 (작성 화면 재사용)
   - 피드 삭제 확인 다이얼로그
   - 삭제 시 이미지도 함께 삭제 (선택)

6. **라우팅 통합**
   - `/celebrity/feeds/create` 라우트 추가
   - `/celebrity/feeds` 라우트 추가
   - `/celebrity/feeds/:feedId/edit` 라우트 추가
   - 셀럽 대시보드에 "피드 작성" 버튼 추가

7. **팬 피드 통합 (선택)**
   - 팬 홈 화면에 셀럽 피드 표시 (향후 구현)
   - 구독한 셀럽의 피드만 표시 (향후 구현)

### 완료 조건

- [ ] 셀럽이 텍스트 피드를 작성할 수 있음
- [ ] 셀럽이 이미지를 업로드할 수 있음
- [ ] 셀럽이 피드를 수정/삭제할 수 있음
- [ ] 이미지 업로드가 정상 작동함 (Supabase Storage)
- [ ] 여러 이미지 업로드가 가능함 (선택)
- [ ] 피드 목록이 정상 표시됨

### 산출물

- 피드 작성 화면
- 피드 목록 화면
- 피드 서비스
- 피드 모델
- 이미지 업로드 기능

### 예상 소요 시간

2일

### 의존성

- WP-1.1 (데이터베이스 스키마 - feeds 테이블, 필요 시 추가)
- WP-1.5 (RBAC - 셀럽 권한 검증)
- Supabase Storage 설정

**참고**: feeds 테이블이 스키마에 없을 경우, WP-1.1에 추가하거나 별도 마이그레이션으로 추가 필요

---

## Work Package 의존성 다이어그램

```
WP-3.1 (질문 큐레이션 대시보드)
    ↓
WP-3.2 (답변 작성 시스템) ← WP-3.1
    ↓
WP-3.3 (답변 관리) ← WP-3.2
    ↓
WP-3.4 (셀럽 프로필 관리) ← 독립적 (병렬 개발 가능)
    ↓
WP-3.5 (셀럽 피드 작성) ← 독립적 (병렬 개발 가능)
```

---

## 전체 타임라인 (12.5일 기준)

| 일차 | Work Package | 누적 진행률 |
|------|--------------|------------|
| 1-3일 | WP-3.1: 질문 큐레이션 대시보드 | 24% |
| 4-6일 | WP-3.2: 답변 작성 시스템 | 48% |
| 7-9일 | WP-3.3: 답변 관리 | 72% |
| 10-11일 | WP-3.4: 셀럽 프로필 관리 | 88% |
| 12-12.5일 | WP-3.5: 셀럽 피드 작성 | 100% |

---

## Vertical Slicing 원칙 적용

각 Work Package는 **독립적으로 테스트 가능한 사용자 가치**를 전달합니다:

1. **WP-3.1**: 질문 큐레이션 확인 → Top 질문 발견 (핵심 가치 전달)
2. **WP-3.2**: 질문 선택 → 답변 작성 → 게시 (핵심 플로우 완성)
3. **WP-3.3**: 내 답변 관리 → 콘텐츠 관리 (추가 가치)
4. **WP-3.4**: 프로필 관리 → 브랜드 표현 (추가 가치)
5. **WP-3.5**: 피드 작성 → 자유로운 소통 (추가 가치)

각 WP 완료 후에는 **"동작하는 소프트웨어"**가 생성되며, 사용자가 실제로 테스트할 수 있는 상태입니다.

---

## 완료 조건 체크리스트 (Milestone 3 전체)

- [ ] 셀럽이 좋아요 Top 10 질문 확인 가능
- [ ] 질문 선택 후 답변 작성 및 게시 성공
- [ ] 답변이 팬 피드에 실시간 반영
- [ ] 셀럽 피드 작성 및 이미지 업로드 정상 작동
- [ ] 답변 안 한 질문은 계속 노출, 답변한 질문은 '답변완료' 상태 변경
- [ ] 셀럽이 자신의 프로필을 관리할 수 있음
- [ ] 셀럽이 자신의 답변을 관리할 수 있음

---

## 기술적 고려사항

### 1. 실시간 업데이트
- Supabase Realtime을 활용하여 답변 게시 시 팬 피드에 자동 반영
- 질문 좋아요 수 실시간 업데이트 (선택)

### 2. 이미지 업로드
- Supabase Storage 사용
- 이미지 크기 제한 및 압축 고려
- 업로드 진행률 표시

### 3. 권한 관리
- 셀럽만 접근 가능한 기능 (PermissionChecker 활용)
- RLS 정책으로 데이터베이스 레벨 권한 검증

### 4. 상태 관리
- 답변 게시 시 질문 상태 자동 업데이트 (트리거 또는 서비스 레벨)
- 임시저장 답변은 상태 변경 없음

### 5. 성능 최적화
- 질문 큐레이션 쿼리 최적화 (인덱스 활용)
- 이미지 로딩 최적화 (캐싱, 지연 로딩)

---

## 향후 확장 가능성

1. **답변 통계**
   - 조회수, 좋아요 수 추적
   - 답변 성과 분석

2. **고급 필터링**
   - 키워드 기반 질문 검색
   - 카테고리별 질문 분류

3. **알림 시스템**
   - 새로운 인기 질문 알림
   - 팬 반응 알림

4. **콘텐츠 스케줄링**
   - 답변 예약 게시
   - 피드 예약 게시

