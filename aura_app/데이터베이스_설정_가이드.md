# 데이터베이스 설정 가이드

## 문제 상황

역할 선택 화면에서 다음과 같은 오류가 발생하는 경우:

```
역할 저장 중 오류가 발생했습니다: PostgrestException(message: Could not find the table 'public.users' in the schema cache, code: PGRST205, details: Not Found, hint: null)
```

이는 Supabase 데이터베이스에 `users` 테이블이 아직 생성되지 않았기 때문입니다.

## 해결 방법

### 1. Supabase Dashboard 접속

1. [Supabase Dashboard](https://app.supabase.com)에 접속
2. 프로젝트 선택 (https://yapgzrhyegjoymwzvuwi.supabase.co)

### 2. SQL Editor 열기

1. 좌측 메뉴에서 **SQL Editor** 클릭
2. **New query** 버튼 클릭

### 3. 마이그레이션 SQL 실행

`supabase/migrations/001_initial_schema.sql` 파일의 내용을 복사하여 SQL Editor에 붙여넣고 실행하세요.

**파일 위치**: `C:\modu\aura_app\supabase\migrations\001_initial_schema.sql`

또는 다음 단계를 따르세요:

1. SQL Editor에서 아래 내용을 복사하여 붙여넣기
2. **RUN** 버튼 클릭하여 실행

### 4. 마이그레이션 SQL (요약)

마이그레이션 파일은 다음을 생성합니다:

- `users` 테이블 (사용자 프로필)
- `questions` 테이블 (질문)
- `answers` 테이블 (답변)
- `subscriptions` 테이블 (구독)
- `communities` 테이블 (커뮤니티)
- 기타 관련 테이블
- RLS (Row Level Security) 정책
- 인덱스

### 5. 실행 확인

마이그레이션 실행 후:

1. 좌측 메뉴에서 **Table Editor** 클릭
2. `users` 테이블이 생성되었는지 확인
3. 테이블 구조 확인 (id, email, role, display_name, avatar_url, bio, created_at, updated_at)

### 6. RLS 정책 확인

1. `users` 테이블을 선택
2. **Policies** 탭에서 RLS 정책이 활성화되어 있는지 확인

## 전체 마이그레이션 파일 경로

```
C:\modu\aura_app\supabase\migrations\001_initial_schema.sql
```

이 파일의 전체 내용을 SQL Editor에 복사하여 실행하면 모든 테이블과 정책이 생성됩니다.

## 추가 참고사항

- 마이그레이션은 한 번만 실행하면 됩니다
- 이미 테이블이 존재하면 `CREATE TABLE IF NOT EXISTS` 구문으로 인해 에러가 발생하지 않습니다
- 마이그레이션 실행 후 앱을 재시작할 필요는 없습니다 (즉시 적용됨)

## 문제가 계속 발생하는 경우

1. Supabase 프로젝트가 활성 상태인지 확인
2. SQL Editor에서 실행한 쿼리의 오류 메시지 확인
3. Table Editor에서 테이블이 실제로 생성되었는지 확인
4. Supabase 프로젝트의 Database > Settings에서 연결 정보 확인


