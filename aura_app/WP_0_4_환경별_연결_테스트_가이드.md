# WP-0.4: 환경별 연결 테스트 가이드

## 📋 테스트 개요

이 가이드는 WP-0.4에서 구현한 개발/스테이징/프로덕션 환경 분리 기능을 실제로 테스트하는 방법을 안내합니다.

**테스트 목적**:
- 각 환경에서 올바른 Supabase 프로젝트에 연결되는지 확인
- 환경 전환 시 올바른 설정 파일이 로드되는지 확인
- 앱 화면에서 환경 배지가 올바르게 표시되는지 확인

---

## ✅ 사전 준비 사항

### 1. Supabase 프로젝트 생성 완료
- ✅ `aura-mvp-dev` (Development 환경용)
- ✅ `aura-mvp-prod` (Production 환경용)
- ⚠️ Staging 환경은 Development 프로젝트를 사용 (2개 프로젝트 구성)

### 2. 환경 파일 생성 및 설정 완료
- ✅ `.env.development` - DEV_SUPABASE_URL, DEV_SUPABASE_ANON_KEY 설정
- ✅ `.env.staging` - STAGING_SUPABASE_URL, STAGING_SUPABASE_ANON_KEY 설정 (또는 DEV_* 사용)
- ✅ `.env.production` - PROD_SUPABASE_URL, PROD_SUPABASE_ANON_KEY 설정

### 3. 환경 파일 확인 방법

PowerShell에서 다음 명령어로 환경 파일이 올바르게 설정되었는지 확인:

```powershell
cd C:\modu\aura_app

# Development 환경 파일 확인
Get-Content .env.development | Select-String "DEV_SUPABASE"

# Staging 환경 파일 확인
Get-Content .env.staging | Select-String "STAGING_SUPABASE|DEV_SUPABASE"

# Production 환경 파일 확인
Get-Content .env.production | Select-String "PROD_SUPABASE"
```

**확인 사항**:
- URL 형식: `https://xxxxx.supabase.co`
- Anon Key 형식: `eyJ...` (JWT 토큰 형식)

---

## 🧪 환경별 연결 테스트

### 테스트 1: Development 환경

#### 실행 방법
```powershell
cd C:\modu\aura_app
.\scripts\run_dev.ps1
```

또는 직접 실행:
```powershell
flutter run --dart-define=ENVIRONMENT=development
```

#### 확인 사항

**콘솔 출력**:
```
✅ 환경 설정 완료: development
✅ 환경 파일 로드 성공: .env.development
✅ Supabase 초기화 성공
   URL: https://your-dev-project-id.supabase.co
✅ Supabase 연결 테스트 성공
   환경: development
   WP-0.4: 환경별 연결 확인 완료
```

**앱 화면**:
- 앱 제목: "AURA - DEVELOPMENT 환경"
- AppBar 색상: 파란색 (Colors.blue.shade700)
- 화면 중앙: "현재 환경: DEVELOPMENT" (파란색 텍스트)

**연결 확인**:
- Supabase 프로젝트: `aura-mvp-dev`에 연결되어야 함
- Supabase 대시보드에서 API 호출 로그 확인 가능

---

### 테스트 2: Staging 환경

#### 실행 방법
```powershell
cd C:\modu\aura_app
.\scripts\run_staging.ps1
```

또는 직접 실행:
```powershell
flutter run --dart-define=ENVIRONMENT=staging
```

#### 확인 사항

**콘솔 출력**:
```
✅ 환경 설정 완료: staging
✅ 환경 파일 로드 성공: .env.staging
✅ Supabase 초기화 성공
   URL: https://your-dev-project-id.supabase.co (또는 staging 프로젝트)
✅ Supabase 연결 테스트 성공
   환경: staging
   WP-0.4: 환경별 연결 확인 완료
```

**앱 화면**:
- 앱 제목: "AURA - STAGING 환경"
- AppBar 색상: 주황색 (Colors.orange.shade700)
- 화면 중앙: "현재 환경: STAGING" (주황색 텍스트)

**연결 확인**:
- 2개 프로젝트 구성: `aura-mvp-dev` 프로젝트에 연결되어야 함
- 3개 프로젝트 구성: 별도의 staging 프로젝트에 연결되어야 함

---

### 테스트 3: Production 환경

#### 실행 방법
```powershell
cd C:\modu\aura_app
.\scripts\run_prod.ps1
```

또는 직접 실행:
```powershell
flutter run --dart-define=ENVIRONMENT=production
```

#### 확인 사항

**콘솔 출력**:
```
✅ 환경 설정 완료: production
✅ 환경 파일 로드 성공: .env.production
✅ Supabase 초기화 성공
   URL: https://your-prod-project-id.supabase.co
✅ Supabase 연결 테스트 성공
   환경: production
   WP-0.4: 환경별 연결 확인 완료
```

**앱 화면**:
- 앱 제목: "AURA - PRODUCTION 환경"
- AppBar 색상: 보라색 (Colors.deepPurple)
- 화면 중앙: "현재 환경: PRODUCTION" (보라색 텍스트)

**연결 확인**:
- Supabase 프로젝트: `aura-mvp-prod`에 연결되어야 함
- ⚠️ **주의**: Production 환경은 실제 서비스용이므로 신중하게 테스트하세요.

---

## 🔍 문제 해결

### 문제 1: 환경 파일을 찾을 수 없음

**에러 메시지**:
```
❌ 환경 파일 로드 실패: .env.development
```

**해결 방법**:
1. 환경 파일이 프로젝트 루트에 있는지 확인
2. 파일 이름이 정확한지 확인 (`.env.development`, `.env.staging`, `.env.production`)
3. 파일이 `.gitignore`에 포함되어 있지만 실제로 존재하는지 확인

---

### 문제 2: Supabase 연결 실패

**에러 메시지**:
```
⚠️ Supabase 연결 테스트 실패
```

**해결 방법**:
1. 환경 변수 값 확인:
   ```powershell
   Get-Content .env.development
   ```
2. Supabase 프로젝트 URL과 Anon Key가 올바른지 확인
3. 인터넷 연결 확인
4. Supabase 프로젝트 상태 확인 (대시보드에서 프로젝트가 활성화되어 있는지)

---

### 문제 3: 잘못된 환경 변수 이름

**에러 메시지**:
```
SUPABASE_URL이 설정되지 않았습니다.
```

**해결 방법**:
- Development: `DEV_SUPABASE_URL`, `DEV_SUPABASE_ANON_KEY`
- Staging: `STAGING_SUPABASE_URL`, `STAGING_SUPABASE_ANON_KEY` (또는 `DEV_*` 사용)
- Production: `PROD_SUPABASE_URL`, `PROD_SUPABASE_ANON_KEY`

환경 파일에서 변수 이름이 정확한지 확인하세요.

---

### 문제 4: 환경이 올바르게 전환되지 않음

**증상**: 항상 development 환경으로 실행됨

**해결 방법**:
1. `dart-define` 플래그 확인:
   ```powershell
   flutter run --dart-define=ENVIRONMENT=staging
   ```
2. 환경 이름 확인: `development`, `staging`, `production` (소문자)
3. 콘솔에서 환경 초기화 메시지 확인:
   ```
   ✅ 환경 설정 완료: staging
   ```

---

## 📊 테스트 체크리스트

각 환경에서 다음 항목을 확인하세요:

### Development 환경
- [ ] `.env.development` 파일 존재
- [ ] `DEV_SUPABASE_URL` 및 `DEV_SUPABASE_ANON_KEY` 설정됨
- [ ] 앱 실행 시 콘솔에 "✅ Supabase 연결 테스트 성공" 메시지 표시
- [ ] 앱 화면에 "DEVELOPMENT" 환경 배지 표시
- [ ] AppBar 색상이 파란색
- [ ] `aura-mvp-dev` 프로젝트에 연결됨

### Staging 환경
- [ ] `.env.staging` 파일 존재
- [ ] `STAGING_SUPABASE_URL` 및 `STAGING_SUPABASE_ANON_KEY` 설정됨 (또는 `DEV_*` 사용)
- [ ] 앱 실행 시 콘솔에 "✅ Supabase 연결 테스트 성공" 메시지 표시
- [ ] 앱 화면에 "STAGING" 환경 배지 표시
- [ ] AppBar 색상이 주황색
- [ ] 올바른 Supabase 프로젝트에 연결됨

### Production 환경
- [ ] `.env.production` 파일 존재
- [ ] `PROD_SUPABASE_URL` 및 `PROD_SUPABASE_ANON_KEY` 설정됨
- [ ] 앱 실행 시 콘솔에 "✅ Supabase 연결 테스트 성공" 메시지 표시
- [ ] 앱 화면에 "PRODUCTION" 환경 배지 표시
- [ ] AppBar 색상이 보라색
- [ ] `aura-mvp-prod` 프로젝트에 연결됨

---

## 🎯 테스트 완료 기준

WP-0.4 요구사항 달성 확인:

1. ✅ **3개 환경 모두 Supabase 연결 테스트 성공**
   - Development: `aura-mvp-dev` 연결 성공
   - Staging: Development 프로젝트 또는 별도 프로젝트 연결 성공
   - Production: `aura-mvp-prod` 연결 성공

2. ✅ **환경 전환 시 올바른 Supabase 프로젝트 연결 확인**
   - 각 환경에서 다른 프로젝트에 연결됨
   - 환경 파일이 올바르게 로드됨

3. ✅ **환경별 앱 배지 표시 확인**
   - Development: 파란색 AppBar
   - Staging: 주황색 AppBar
   - Production: 보라색 AppBar

---

## 📝 테스트 결과 기록

테스트 완료 후 다음 정보를 기록하세요:

- 테스트 일자: ___________
- 테스트 환경: Development / Staging / Production
- 연결 상태: ✅ 성공 / ❌ 실패
- 발견된 문제: ___________
- 해결 방법: ___________

---

## 🔗 관련 문서

- [WP-0.4 구현 완료 리포트](./WP_0_4_구현_완료_리포트.md)
- [환경 설정 가이드](./docs/ENVIRONMENT_SETUP.md)
- [WP-0.4 실제 테스트 검증 리포트](./WP_0_4_실제_테스트_검증_리포트.md)

