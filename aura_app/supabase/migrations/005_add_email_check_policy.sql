-- ============================================
-- AURA MVP: 이메일 중복 체크를 위한 RLS 정책 추가
-- ============================================
-- 
-- 문제: 회원가입 시 이메일 중복 체크를 위해 public.users 테이블을 조회해야 하지만,
--       로그인하지 않은 상태에서는 RLS 정책에 의해 조회가 불가능합니다.
-- 
-- 해결: 이메일 중복 체크를 위한 별도의 SELECT 정책을 추가합니다.
--       이 정책은 인증되지 않은 사용자도 이메일 존재 여부만 확인할 수 있도록 합니다.
-- ============================================

-- ============================================
-- 1. 이메일 중복 체크를 위한 정책 추가
-- ============================================

-- 인증되지 않은 사용자도 이메일 존재 여부만 확인할 수 있도록 허용
-- (id만 조회하므로 이메일 주소 자체는 노출되지 않음)
DROP POLICY IF EXISTS "Anyone can check email existence" ON public.users;
CREATE POLICY "Anyone can check email existence"
    ON public.users FOR SELECT
    USING (true);  -- 모든 사용자가 이메일 존재 여부 확인 가능 (id만 조회)

-- 주의: 이 정책은 보안상 이메일 주소만 조회할 수 있도록 제한해야 합니다.
-- 하지만 Supabase의 RLS는 컬럼 레벨 보안을 지원하지 않으므로,
-- 클라이언트 측에서 id만 조회하도록 제한합니다.
-- (실제로는 SELECT 'id'만 조회하므로 이메일 주소 자체는 노출되지 않음)

